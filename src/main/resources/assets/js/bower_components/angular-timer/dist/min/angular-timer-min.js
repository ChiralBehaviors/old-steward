var timerModule=angular.module("timer",[]).directive("timer",["$compile",function(t){return{restrict:"EA",replace:!1,scope:{interval:"=interval",startTimeAttr:"=startTime",endTimeAttr:"=endTime",countdownattr:"=countdown",finishCallback:"&finishCallback",autoStart:"&autoStart",language:"@?",fallback:"@?",maxTimeUnit:"="},controller:["$scope","$element","$attrs","$timeout","I18nService","$interpolate","progressBarService",function(n,e,i,o,s,a,r){function m(){n.timeoutId&&clearTimeout(n.timeoutId)}function u(){var t={};void 0!==i.startTime&&(n.millis=moment().diff(moment(n.startTimeAttr))),t=l.getTimeUnits(n.millis),n.maxTimeUnit&&"day"!==n.maxTimeUnit?"second"===n.maxTimeUnit?(n.seconds=Math.floor(n.millis/1e3),n.minutes=0,n.hours=0,n.days=0,n.months=0,n.years=0):"minute"===n.maxTimeUnit?(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4),n.hours=0,n.days=0,n.months=0,n.years=0):"hour"===n.maxTimeUnit?(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4%60),n.hours=Math.floor(n.millis/36e5),n.days=0,n.months=0,n.years=0):"month"===n.maxTimeUnit?(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4%60),n.hours=Math.floor(n.millis/36e5%24),n.days=Math.floor(n.millis/36e5/24%30),n.months=Math.floor(n.millis/36e5/24/30),n.years=0):"year"===n.maxTimeUnit&&(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4%60),n.hours=Math.floor(n.millis/36e5%24),n.days=Math.floor(n.millis/36e5/24%30),n.months=Math.floor(n.millis/36e5/24/30%12),n.years=Math.floor(n.millis/36e5/24/365)):(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4%60),n.hours=Math.floor(n.millis/36e5%24),n.days=Math.floor(n.millis/36e5/24),n.months=0,n.years=0),n.secondsS=1===n.seconds?"":"s",n.minutesS=1===n.minutes?"":"s",n.hoursS=1===n.hours?"":"s",n.daysS=1===n.days?"":"s",n.monthsS=1===n.months?"":"s",n.yearsS=1===n.years?"":"s",n.secondUnit=t.seconds,n.minuteUnit=t.minutes,n.hourUnit=t.hours,n.dayUnit=t.days,n.monthUnit=t.months,n.yearUnit=t.years,n.sseconds=n.seconds<10?"0"+n.seconds:n.seconds,n.mminutes=n.minutes<10?"0"+n.minutes:n.minutes,n.hhours=n.hours<10?"0"+n.hours:n.hours,n.ddays=n.days<10?"0"+n.days:n.days,n.mmonths=n.months<10?"0"+n.months:n.months,n.yyears=n.years<10?"0"+n.years:n.years}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),n.autoStart=i.autoStart||i.autostart,n.language=n.language||"en",n.fallback=n.fallback||"en",n.$watch("language",function(t,e){void 0!==t&&l.init(t,n.fallback)});var l=new s;l.init(n.language,n.fallback),n.displayProgressBar=0,n.displayProgressActive="active",0===e.html().trim().length?e.append(t("<span>"+a.startSymbol()+"millis"+a.endSymbol()+"</span>")(n)):e.append(t(e.contents())(n)),n.startTime=null,n.endTime=null,n.timeoutId=null,n.countdown=n.countdownattr&&parseInt(n.countdownattr,10)>=0?parseInt(n.countdownattr,10):void 0,n.isRunning=!1,n.$on("timer-start",function(){n.start()}),n.$on("timer-resume",function(){n.resume()}),n.$on("timer-stop",function(){n.stop()}),n.$on("timer-clear",function(){n.clear()}),n.$on("timer-reset",function(){n.reset()}),n.$on("timer-set-countdown",function(t,e){n.countdown=e}),n.$watch("startTimeAttr",function(t,e){t!==e&&n.isRunning&&n.start()}),n.$watch("endTimeAttr",function(t,e){t!==e&&n.isRunning&&n.start()}),n.start=e[0].start=function(){n.startTime=n.startTimeAttr?moment(n.startTimeAttr):moment(),n.endTime=n.endTimeAttr?moment(n.endTimeAttr):null,n.countdown||(n.countdown=n.countdownattr&&parseInt(n.countdownattr,10)>0?parseInt(n.countdownattr,10):void 0),m(),d(),n.isRunning=!0},n.resume=e[0].resume=function(){m(),n.countdownattr&&(n.countdown+=1),n.startTime=moment().diff(moment(n.stoppedTime).diff(moment(n.startTime))),d(),n.isRunning=!0},n.stop=n.pause=e[0].stop=e[0].pause=function(){var t=n.timeoutId;n.clear(),n.$emit("timer-stopped",{timeoutId:t,millis:n.millis,seconds:n.seconds,minutes:n.minutes,hours:n.hours,days:n.days})},n.clear=e[0].clear=function(){n.stoppedTime=moment(),m(),n.timeoutId=null,n.isRunning=!1},n.reset=e[0].reset=function(){n.startTime=n.startTimeAttr?moment(n.startTimeAttr):moment(),n.endTime=n.endTimeAttr?moment(n.endTimeAttr):null,n.countdown=n.countdownattr&&parseInt(n.countdownattr,10)>0?parseInt(n.countdownattr,10):void 0,m(),d(),n.isRunning=!1,n.clear()},e.bind("$destroy",function(){m(),n.isRunning=!1}),n.countdownattr?(n.millis=1e3*n.countdownattr,n.addCDSeconds=e[0].addCDSeconds=function(t){n.countdown+=t,n.$digest(),n.isRunning||n.start()},n.$on("timer-add-cd-seconds",function(t,e){o(function(){n.addCDSeconds(e)})}),n.$on("timer-set-countdown-seconds",function(t,e){n.isRunning||n.clear(),n.countdown=e,n.millis=1e3*e,u()})):n.millis=0,u();var d=function c(){var t=null;n.millis=moment().diff(n.startTime);var e=n.millis%1e3;return n.endTimeAttr&&(t=n.endTimeAttr,n.millis=moment(n.endTime).diff(moment()),e=n.interval-n.millis%1e3),n.countdownattr&&(t=n.countdownattr,n.millis=1e3*n.countdown),n.millis<0?(n.stop(),n.millis=0,u(),void(n.finishCallback&&n.$eval(n.finishCallback))):(u(),n.timeoutId=setTimeout(function(){c(),n.$digest()},n.interval-e),n.$emit("timer-tick",{timeoutId:n.timeoutId,millis:n.millis}),n.countdown>0?n.countdown--:n.countdown<=0&&(n.stop(),n.$emit("timer-finished"),n.finishCallback&&n.$eval(n.finishCallback)),void(null!==t&&(n.progressBar=r.calculateProgressBar(n.startTime,n.millis,n.endTime,n.countdownattr),100===n.progressBar&&(n.displayProgressActive=""))))};(void 0===n.autoStart||n.autoStart===!0)&&n.start()}]}}]);"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports=timerModule);var app=angular.module("timer");app.factory("I18nService",function(){var t=function(){};return t.prototype.language="en",t.prototype.fallback="en",t.prototype.timeHumanizer={},t.prototype.init=function n(t,e){var i=humanizeDuration.getSupportedLanguages();this.fallback=void 0!==e?e:"en",-1===i.indexOf(e)&&(this.fallback="en"),this.language=t,-1===i.indexOf(t)&&(this.language=this.fallback),moment.locale(this.language),this.timeHumanizer=humanizeDuration.humanizer({language:this.language,halfUnit:!1})},t.prototype.getTimeUnits=function e(t){var n=1e3*Math.round(t/1e3),e={};return"undefined"!=typeof this.timeHumanizer?e={millis:this.timeHumanizer(n,{units:["milliseconds"]}),seconds:this.timeHumanizer(n,{units:["seconds"]}),minutes:this.timeHumanizer(n,{units:["minutes","seconds"]}),hours:this.timeHumanizer(n,{units:["hours","minutes","seconds"]}),days:this.timeHumanizer(n,{units:["days","hours","minutes","seconds"]}),months:this.timeHumanizer(n,{units:["months","days","hours","minutes","seconds"]}),years:this.timeHumanizer(n,{units:["years","months","days","hours","minutes","seconds"]})}:console.error('i18nService has not been initialized. You must call i18nService.init("en") for example'),e},t});var app=angular.module("timer");app.factory("progressBarService",function(){var t=function(){};return t.prototype.calculateProgressBar=function n(t,e,i,o){var s=0,a,r;return e/=1e3,null!==i?(a=moment(i),r=a.diff(t,"seconds"),s=100*e/r):s=100*e/o,s=100-s,s=Math.round(10*s)/10,s>100&&(s=100),s},new t});